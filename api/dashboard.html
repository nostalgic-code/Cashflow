<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Cashflow Loans</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-green-50 via-white to-green-100 min-h-screen">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-green-100 flex flex-col py-8 px-6 shadow-xl">
      <div class="flex items-center gap-3 mb-10">
        <img src="/static/assets/images/logo.jpeg" alt="Logo" class="w-12 h-12 rounded-full shadow border border-green-200">
        <span class="text-2xl font-bold text-green-800 tracking-tight">Cashflow Admin</span>
      </div>
      <nav class="flex flex-col gap-2 mt-4">
        <a href="/dashboard.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-green-900 font-semibold bg-green-100">
          <svg class="w-6 h-6 text-green-700" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6"/></svg>
          Dashboard
        </a>
        <a href="/pages.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-green-700 hover:bg-green-50 transition">
          <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-6a2 2 0 012-2h2a2 2 0 012 2v6m-6 0h6"/></svg>
          Applications
        </a>
      </nav>
      <div class="mt-auto flex items-center gap-3 pt-10">
        <div class="relative group">
          <span id="profile-tooltip" class="absolute left-1/2 -translate-x-1/2 -top-10 bg-gray-900 text-white text-xs rounded px-3 py-1 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10">Username</span>
          <div class="w-10 h-10 rounded-full bg-green-200 flex items-center justify-center text-green-900 text-xl font-bold cursor-pointer border-2 border-green-400" id="profile-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.5 20.25a8.25 8.25 0 1115 0v.75a.75.75 0 01-.75.75h-13.5a.75.75 0 01-.75-.75v-.75z" />
            </svg>
          </div>
        </div>
        <div class="flex flex-col">
          <span class="text-green-900 font-semibold text-base" id="sidebar-username"></span>
          <button id="logout-btn" class="text-green-700 hover:underline text-xs mt-1 text-left">Logout</button>
        </div>
      </div>
    </aside>
    <!-- Main Content -->
    <main class="flex-1 p-12 bg-gradient-to-br from-white via-green-50 to-green-100">
      <div class="flex justify-between items-center mb-10">
        <h1 class="text-4xl font-extrabold text-green-900 tracking-tight">Dashboard Overview</h1>
        <button id="refresh-stats-btn" class="bg-green-700 hover:bg-green-900 text-white font-semibold px-6 py-3 rounded-lg shadow transition-all duration-200 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582M20 20v-5h-.581M5 19A9 9 0 1119 5"/></svg>
          Refresh Stats
        </button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
        <div class="bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center border-t-4 border-green-600">
          <div class="bg-green-100 rounded-full p-4 mb-4">
            <svg class="w-8 h-8 text-green-700" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 0V4m0 16v-4"/></svg>
          </div>
          <div class="text-5xl font-extrabold text-green-900" id="stat-unsecured">0</div>
          <div class="text-green-700 mt-2 font-semibold text-lg">Unsecured Applications</div>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center border-t-4 border-blue-600">
          <div class="bg-blue-100 rounded-full p-4 mb-4">
            <svg class="w-8 h-8 text-blue-700" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a5 5 0 00-10 0v2a5 5 0 00-1 9.9V21a1 1 0 001 1h10a1 1 0 001-1v-2.1A5 5 0 0017 9z"/></svg>
          </div>
          <div class="text-5xl font-extrabold text-blue-900" id="stat-secured">0</div>
          <div class="text-blue-700 mt-2 font-semibold text-lg">Secured Applications</div>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center border-t-4 border-yellow-500">
          <div class="bg-yellow-100 rounded-full p-4 mb-4">
            <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 01-8 0m8 0a4 4 0 00-8 0m8 0V5a4 4 0 00-8 0v2m8 0a4 4 0 01-8 0m8 0v2a4 4 0 01-8 0"/></svg>
          </div>
          <div class="text-5xl font-extrabold text-yellow-700" id="stat-admins">0</div>
          <div class="text-yellow-700 mt-2 font-semibold text-lg">Admins</div>
        </div>
      </div>
      <div class="flex gap-6">
        <a href="/pages.html" class="bg-green-700 hover:bg-green-900 text-white font-semibold px-8 py-4 rounded-xl shadow-lg transition-all duration-200 flex items-center gap-3 text-lg">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-6a2 2 0 012-2h2a2 2 0 012 2v6m-6 0h6"/></svg>
          View Submitted Forms
        </a>
      </div>
    </main>
  </div>
  <script>
    function fetchStats() {
      fetch('https://cashflow-bybn.onrender.com/admin/stats')
        .then(r => r.json())
        .then(stats => {
          document.getElementById('stat-unsecured').textContent = stats.unsecured_loans;
          document.getElementById('stat-secured').textContent = stats.secured_loans;
          document.getElementById('stat-admins').textContent = stats.admins;
        })
        .catch(() => {
          document.getElementById('stat-unsecured').textContent = 'Err';
          document.getElementById('stat-secured').textContent = 'Err';
          document.getElementById('stat-admins').textContent = 'Err';
        });
    }
    fetchStats();
    document.getElementById('refresh-stats-btn').onclick = fetchStats;
    document.getElementById('logout-btn').onclick = function() {
      localStorage.removeItem('admin-auth');
      window.location.href = '/admin.html';
    };
    // Set username in tooltip, sidebar, and profile icon
    const username = localStorage.getItem('admin-username') || 'Admin';
    document.getElementById('profile-tooltip').textContent = username;
    const sidebarUsername = document.getElementById('sidebar-username');
    if (sidebarUsername) sidebarUsername.textContent = username;
    const icon = document.getElementById('profile-icon');
    if (icon) {
      icon.title = username;
      // Show first letter of username in icon
      icon.textContent = username.charAt(0).toUpperCase();
      icon.innerHTML += '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 absolute opacity-0 pointer-events-none"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.5 20.25a8.25 8.25 0 1115 0v.75a.75.75 0 01-.75.75h-13.5a.75.75 0 01-.75-.75v-.75z" /></svg>';
    }
  </script>
</body>
</html>
